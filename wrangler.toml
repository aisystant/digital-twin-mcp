name = "digital-twin-mcp"
main = "src/worker-sse.js"
compatibility_date = "2024-12-01"

# Account details - update with your Cloudflare account ID
# account_id = "your-account-id-here"

# Observability configuration for enhanced logging
[observability]
enabled = true

[observability.logs]
enabled = true
invocation_logs = true

[env.production]
name = "digital-twin-mcp-prod"
routes = [
  { pattern = "digital-twin-mcp.yourdomain.com", custom_domain = true }
]

[env.staging]
name = "digital-twin-mcp-staging"

# Ory auth testing environment (deployed from ory-auth branch)
[env.ory-auth]
name = "digital-twin-mcp-ory-auth"

[env.ory-auth.vars]
ORY_PROJECT_URL = "https://focused-banzai-t5mpd5nsrk.projects.oryapis.com"
RESOURCE_URL = "https://digital-twin-mcp-ory-auth.aisystant.workers.dev"
CORS_ORIGIN = "*"

# KV for ory-auth env (same as main)
[[env.ory-auth.kv_namespaces]]
binding = "DIGITAL_TWIN_DATA"
id = "640bc613fc57435bbc01da89b5800897"

# KV namespace for persistent twin data storage
[[kv_namespaces]]
binding = "DIGITAL_TWIN_DATA"
id = "640bc613fc57435bbc01da89b5800897"

# Optional: Configure D1 database for SQL storage (future enhancement)
# [[d1_databases]]
# binding = "DB"
# database_name = "digital-twin-db"
# database_id = "your-d1-database-id"

# ============================================
# OAuth2 Authentication (Ory.sh)
# ============================================
#
# This server implements MCP OAuth2 spec (RFC 9728):
# - /.well-known/oauth-protected-resource - Protected Resource Metadata
# - JWT validation via Ory JWKS
#
# Environment variables:
#   ORY_PROJECT_URL - Ory project URL (authorization server)
#   RESOURCE_URL - This server's public URL (optional, auto-detected)
#   CORS_ORIGIN - Allowed CORS origin (optional, defaults to *)
#
# For ory-auth env, ORY_PROJECT_URL is set in [env.ory-auth.vars] above.
